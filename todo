replace more asserts with explicit failures (returned to caller)
popping (e.g. in 'recipe')
